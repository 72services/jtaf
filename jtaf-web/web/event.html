<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Edit event</title>
        <link rel="stylesheet" href="css/jtaf.css">

        <script src="javascript/util.js"></script>
        <script src="javascript/navigation.js"></script>
        <script>
            var jtafEvent;
            var serie;

            function loadData() {
                var s = sessionStorage.getItem("serie");
                serie = JSON.parse(s);

                var id = param().id;
                if (id === undefined) {
                    jtafEvent = new Object();
                    el("event_name").focus();
                } else {
                    sendRequest("GET", "/jtaf/res/events/" + id, 200, function(response) {
                        parseAndFill(response);
                    });
                }
            }

            function back() {
                window.location = "serie.html?id=" + serie.id;
            }

            function parseAndFill(response) {
                jtafEvent = JSON.parse(response);
                fillForm();
            }

            function fillForm() {
                el("event_id").value = jtafEvent.id;
                el("event_name").value = jtafEvent.name;
                var index = 0;
                switch (jtafEvent.type) {
                    case "jump":
                        index = 1;
                        break;
                    case "throw":
                        index = 2;
                        break;
                }
                el("event_type").options[index].selected = true;
                if (jtafEvent.gender === "m") {
                    el("event_gender_m").checked = true;
                }
                else {
                    el("event_gender_f").checked = true;
                }
                el("event_a").value = jtafEvent.a;
                el("event_b").value = jtafEvent.b;
                el("event_c").value = jtafEvent.c;
                el("event_name").focus();
            }

            function save() {
                fillEvent();
                sendRequest("POST", "/jtaf/res/events/", 200, function(response) {
                    parseAndFill(response);
                    info("Event saved");
                }, "application/json", JSON.stringify(jtafEvent));
            }

            function fillEvent() {
                jtafEvent.name = el("event_name").value;
                jtafEvent.type = el("event_type").value;
                if (el("event_gender_m").checked) {
                    jtafEvent.gender = "m";
                }
                else {
                    jtafEvent.gender = "f";
                }
                jtafEvent.a = el("event_a").value;
                jtafEvent.b = el("event_b").value;
                jtafEvent.c = el("event_c").value;
                jtafEvent.serie = serie;
            }

            function deleteEvent(id) {
                sendRequest("DELETE", "/jtaf/res/events/" + id, 204, function() {
                    loadData();
                    info("Event deleted");
                });
            }
        </script>
    </head>
    <body onload="loadData();">
        <div id="main">
            <div id="navigation">
                <script src="javascript/navigation.js"></script>
            </div>

            <h1>Event</h1>

            <form action="javascript:save();">

                <table class="input">
                    <tr>
                        <td>Id</td>
                        <td><input type="text" id="event_id" readonly disabled /></td>
                    </tr>
                    <tr>
                        <td>Name</td>
                        <td><input type="text" id="event_name" required /></td>
                    </tr>
                    <tr>
                        <td>Type</td>
                        <td>
                            <select id="event_type">
                                <option value="run">run</option>
                                <option value="jump">jump</option>
                                <option value="throw">throw</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Gender</td>
                        <td>
                            <input id="event_gender_m" type="radio" name="event_gender" value="m">m
                            <input id="event_gender_f" type="radio" name="event_gender" value="f">f
                        </td>
                    </tr>
                    <tr>
                        <td>A</td>
                        <td><input type="text" id="event_a" required /></td>
                    </tr>
                    <tr>
                        <td>B</td>
                        <td><input type="text" id="event_b" required /></td>
                    </tr>
                    <tr>
                        <td>C</td>
                        <td><input type="text" id="event_c" required /></td>
                    </tr>
                </table>

                <p>
                    <input type="submit" value="Save" />&nbsp;
                    <a href="javascript:back();">Back</a>
                </p>

            </form>

        </div>
    </body>
</html>
